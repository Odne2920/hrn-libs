(function(w){const d=document,ls=localStorage,u="https://cdn.jsdelivr.net/gh/HyperRushNet/hyperrushnet.github.io/assets/json/games.json",sI=["https://unpkg.com/lucide@latest"];sI.forEach(t=>{if(!d.querySelector(`script[src="${t}"]`)){const e=d.createElement("script");e.src=t,e.async=!0,d.head.appendChild(e)}});let db,fP;const fDb=async()=>db||fP||(fP=fetch(u).then(r=>r.ok?r.json():[]).then(data=>(db=data)).catch(()=>db=[]).finally(()=>fP=null),fP),low=s=>String(s).toLowerCase(),L_F="hrn_f",L_S="hrn_st";let st={xp:0,lvl:1,history:[],counts:{}};const sv=()=>ls.setItem(L_S,JSON.stringify(st)),ld=()=>{const s=ls.getItem(L_S);s&&(st={...st,...JSON.parse(s)})};ld();d.addEventListener("game:ready",e=>{const id=+e.detail.id;st.counts[id]=(st.counts[id]||0)+1;st.history=st.history.filter(i=>i!==id);st.history.unshift(id);if(st.history.length>10)st.history.pop();st.xp+=10;st.lvl=Math.floor(Math.sqrt(st.xp)/5)+1;sv()});w.hrn={db:{all:async()=>[...await fDb()],search:async(q)=>{const data=await fDb(),s=low(q.trim());return s?data.filter(g=>low(g.name).includes(s)||low(g.category).includes(s)||(g.device&&g.device.some(d=>low(d).includes(s)))).sort((a,b)=>(low(a.name).indexOf(s)<0?99:low(a.name).indexOf(s))-(low(b.name).indexOf(s)<0?99:low(b.name).indexOf(s))):[...data]},find:async(c)=>{const data=await fDb();return data.filter(g=>Object.keys(c).every(k=>!c[k]||(Array.isArray(g[k])?g[k].some(v=>low(v)===low(c[k])):low(g[k])===low(c[k]))))},random:async()=>{const data=await fDb();return data[Math.floor(Math.random()*data.length)]},toggleFav:id=>{let f=JSON.parse(ls.getItem(L_F)||"[]");id=+id;f=f.includes(id)?f.filter(i=>i!==id):(f.push(id),f);ls.setItem(L_F,JSON.stringify(f));return f},getFavs:async()=>{const f=JSON.parse(ls.getItem(L_F)||"[]"),data=await fDb();return data.filter(g=>f.includes(+g.number))},getMeta:async()=>{const data=await fDb();return{total:data.length,categories:[...new Set(data.map(g=>g.category))].sort(),devices:[...new Set(data.flatMap(g=>g.device||[]))].sort()}}},stats:{get:()=>({...st}),getTop:async()=>{const ids=Object.entries(st.counts).sort((a,b)=>b[1]-a[1]).slice(0,5).map(i=>+i[0]),data=await fDb();return data.filter(g=>ids.includes(g.number)).sort((a,b)=>st.counts[b.number]-st.counts[a.number])},getHistory:async()=>{const data=await fDb();return st.history.map(id=>data.find(g=>g.number===id)).filter(Boolean)},reset:()=>{st={xp:0,lvl:1,history:[],counts:{}};ls.removeItem(L_S)}}};class P extends HTMLElement{constructor(){super();this.attachShadow({mode:"open"})}connectedCallback(){this.render()}render(t="load"){const e=this.getAttribute("accent")||"#ff0055",i="dark"===(this.getAttribute("theme")||"dark"),n=i?"#000":"#fff",r=i?"#fff":"#000",a=i?"rgba(255,255,255,0.1)":"rgba(0,0,0,0.1)",o=this.getAttribute("card-size")||"220px";let l=`<style>:host{display:block;width:${this.getAttribute("width")||"100%"};background:${n};color:${r};font-family:'Inter',sans-serif}.msg{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:300px;text-align:center;padding:20px}.btn{margin-top:15px;padding:10px 20px;background:${e};color:#fff;border:none;cursor:pointer;font-weight:700}.ldr{width:40px;height:40px;border:3px solid ${r}33;border-top-color:${e};border-radius:50%;animation:spin 1s linear infinite}@keyframes spin{to{transform:rotate(360deg)}}.w{position:relative;width:100%;box-sizing:border-box}.w *{box-sizing:border-box}.h{position:sticky;top:0;z-index:150;display:flex;justify-content:flex-end;padding:10px;pointer-events:none}.sh{display:flex;pointer-events:auto}.i{width:0;opacity:0;border:1px solid ${e};background:${i?"rgba(0,0,0,0.9)":"#fff"};color:${i?e:"#000"};transition:.25s ease;outline:none;font-weight:700}.sh.active .i{width:clamp(120px, 30vw, 200px);opacity:1;padding:8px 12px;margin-right:-1px}.tr{width:42px;height:42px;border:1px solid ${e};display:flex;align-items:center;justify-content:center;cursor:pointer;color:${e};background:${n}}.g{display:grid;grid-template-columns:repeat(auto-fill,minmax(min(100%,${o}),1fr));width:100%;margin-top:-62px}.c{aspect-ratio:1/1;border:1px solid ${a};display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;transition:.1s;text-align:center;padding:20px;margin-right:-1px;margin-bottom:-1px}.c:hover{border-color:${e};z-index:5;background:${i?"rgba(255,255,255,0.03)":"rgba(0,0,0,0.02)"}}.ct{font-size:1.1rem;text-transform:uppercase;margin:0;font-weight:900;line-height:1.1}.cn{font-size:11px;margin-top:8px;color:${e};font-family:monospace;font-weight:700;opacity:.6}.ov{position:fixed;top:0;left:0;width:100%;height:100%;z-index:1000;display:none;pointer-events:none}.ov.active{display:block}.sb{position:sticky;top:0;width:100%;height:100vh;background:${n};pointer-events:auto;display:flex;flex-direction:column}.cl{position:absolute;top:10px;right:10px;width:42px;height:42px;border:1px solid #f44;color:#f44;display:flex;align-items:center;justify-content:center;cursor:pointer;background:${n};z-index:1100}.pc{width:100%;height:100%}hrn-game{width:100%!important;height:100%!important;display:block}</style>`;if(t==="load"){l+='<div class="msg"><div class="ldr"></div><p>Loading...</p></div>';this.shadowRoot.innerHTML=l;this.checkDeps()}else{l+=`<div class="w"><div class="h"><div class="sh" id="search-wrapper"><input type="text" class="i" id="search-input" placeholder="SEARCH..."><div class="tr" id="search-toggle"><i data-lucide="${this.getAttribute("search-icon")||"search"}" style="width:18px"></i></div></div></div><div class="g" id="game-grid"></div><div class="ov" id="overlay"><div class="sb"><div class="cl" id="game-close"><i data-lucide="x" style="width:20px"></i></div><div class="pc" id="player-container"></div></div></div></div>`;this.shadowRoot.innerHTML=l;this.initialize()}}checkDeps(){let t=0;const e=setInterval(()=>{if(w.lucide){clearInterval(e);this.render("ready")}else if(t>100){clearInterval(e);this.render("ready")}t++},50)}async initialize(){const s=this.shadowRoot;if(w.lucide)lucide.createIcons({attrs:{"stroke-width":2},nameAttr:"data-lucide",root:s});const grid=s.querySelector("#game-grid"),inp=s.querySelector("#search-input"),wrap=s.querySelector("#search-wrapper"),ov=s.querySelector("#overlay"),pc=s.querySelector("#player-container");s.querySelector("#search-toggle").onclick=e=>{e.stopPropagation();wrap.classList.toggle("active")&&inp.focus()};s.querySelector("#game-close").onclick=()=>{ov.classList.remove("active");pc.innerHTML="";d.body.style.overflow=""};const renderList=list=>{grid.innerHTML=list.map(g=>`<div class="c" data-id="${g.number}"><h3 class="ct">${g.name}</h3><span class="cn">#${String(g.number).padStart(2,"0")}</span></div>`).join("");grid.querySelectorAll(".c").forEach(el=>{el.onclick=()=>{pc.innerHTML=`<hrn-game nr="${el.dataset.id}"></hrn-game>`;ov.classList.add("active");d.body.style.overflow="hidden"}})};const data=await w.hrn.db.all();renderList(data);inp.oninput=async()=>{const res=await w.hrn.db.search(inp.value);renderList(res)}}}customElements.define("hrn-game-portal",P);class G extends HTMLElement{constructor(){super();this.attachShadow({mode:"open"})}connectedCallback(){this.o=new IntersectionObserver(e=>{if(e[0].isIntersecting){this.l();this.o.disconnect()}});this.o.observe(this)}async l(){const nr=this.getAttribute("nr"),pr=this.getAttribute("provider")||"https://hyperrushnet.github.io",cr=this.getAttribute("credits")!=="false",rb=this.getAttribute("redirectblock")!=="false",data=await fDb(),g=data.find(i=>+i.number===+nr),url=g?.link?pr+g.link:pr+"/games-1/bacon-may-die/";const acc="var(--hrn-color,#ff0055)";this.shadowRoot.innerHTML=`<style>.m{width:100%;height:100%;background:#000;position:relative;display:flex;align-items:center;justify-content:center}iframe{width:100%;height:100%;border:none;opacity:0;transition:.5s;z-index:1}iframe.v{opacity:1}.s{position:absolute;width:40px;height:40px;border:3px solid #fff3;border-top-color:${acc};border-radius:50%;animation:r 1s linear infinite}@keyframes r{to{transform:rotate(360deg)}}.c{position:absolute;bottom:12px;right:16px;font-size:11px;color:#999;background:#000d;padding:4px 10px;border-radius:5px;border:1px solid #333;z-index:2}</style><div class="m"><div class="s"></div><iframe allow="autoplay;fullscreen;gamepad"></iframe>${cr?`<div class="c">Powered by HyperRush</div>`:""}</div>`;const f=this.shadowRoot.querySelector("iframe");f.sandbox=`allow-scripts allow-same-origin allow-pointer-lock allow-forms ${rb?"":"allow-popups allow-top-navigation"}`;f.src=url;f.onload=()=>{f.classList.add("v");if(this.shadowRoot.querySelector(".s"))this.shadowRoot.querySelector(".s").remove();this.dispatchEvent(new CustomEvent("game:ready",{detail:{id:nr},bubbles:1,composed:1}))}}}customElements.define("hrn-game",G)})(window);
